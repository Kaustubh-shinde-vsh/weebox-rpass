{
  "manifest_version": 3,
  "name": "Wheebox RPaaS",
  "version": "1.0.8",
  "description": "Extension to proctor candidate",
  "icons": {
    "16": "assets/wheebox16.png",
    "48": "assets/wheebox48.png",
    "128": "assets/wheebox128.png"
  },
  "background": {
    // V3: 'scripts' replaced by 'service_worker' and 'persistent' is removed
    "service_worker": "js/background.js",
    "type": "module"
    // Note: jquery.min.js and rpaasPluginConstants.js will need to be imported
    // inside background_service_worker.js if they are truly needed there.
    // Service workers run in a different context and cannot execute DOM manipulation.
    // If jquery.min.js was only for DOM manipulation, it should be removed from background.
  },
  "action": {
    // V3: 'browser_action' is renamed to 'action'
    "default_icon": "assets/wheebox48.png",
    "default_popup": "popup.html",
    "default_title": "Wheebox RPaaS"
  },
  "content_scripts": [
    {
      "css": [
        "plugins/toast/css/toast.css",
        "css/custom.css",
        "apps/canvas/css/canvas.css"
      ],
      "js": [
        // V3: jQuery.min.js should be careful here. If it modifies the page, it's fine.
        // If it was for background scripts, move it to service worker import.
        "plugins/bootstrap/js/jquery.min.js",
        "plugins/toast/js/toast.js",
        "constants/rpaasPluginConstants.js",
        "js/apiService.js",
        "js/sharedTemplate.js",
        "services/commonService.js",
        "apps/canvas/js/teacherView.js"
      ],
      // V3: 'include_globs' are deprecated, 'matches' are preferred and more flexible.
      // Combining 'include_globs' logic directly into 'matches' where possible.
      // Given the specific nature of these patterns, 'matches' should handle them.
      "matches": ["*://*:*/courses/*/quizzes/*/edit"]
    },
    {
      "css": [
        "plugins/toast/css/toast.css",
        "css/custom.css",
        "apps/canvas/css/canvas.css"
      ],
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "plugins/toast/js/toast.js",
        "js/MP.js",
        "constants/rpaasPluginConstants.js",
        "js/apiService.js",
        "js/sharedTemplate.js",
        "services/commonService.js",
        "services/loginService.js",
        "apps/canvas/js/canvasTemplate.js",
        "apps/canvas/js/studentView.js"
      ],
      "matches": ["*://*:*/courses/*/*/*/take?*=*"]
    },
    {
      "css": [
        "plugins/toast/css/toast.css",
        "css/custom.css",
        "apps/canvas/css/canvas.css"
      ],
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "plugins/toast/js/toast.js",
        "js/MP.js",
        "js/sharedTemplate.js",
        "constants/rpaasPluginConstants.js",
        "services/commonService.js",
        "apps/canvas/js/canvasTemplate.js",
        "apps/canvas/js/takeQuiz.js",
        "js/apiService.js"
      ],
      "matches": [
        "*://*:*/courses/*/quizzes/*/take",
        "*://*/courses/*/quizzes/*/take/questions/*"
      ]
    },
    {
      "css": [
        "css/custom.css",
        "plugins/toast/css/toast.css",
        "apps/canvas/css/canvas.css"
      ],
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "plugins/bootstrap/js/jqpage.js",
        "plugins/toast/js/toast.js",
        "js/sharedTemplate.js",
        "constants/rpaasPluginConstants.js",
        "js/apiService.js",
        "services/loginService.js",
        "services/commonService.js",
        "apps/canvas/js/mpaasTool.js"
      ],
      "matches": ["*://*:*/courses/*/external_tools/*"]
    },
    {
      "css": ["css/custom.css", "apps/canvas/css/canvas.css"],
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "apps/canvas/js/canvasTemplate.js",
        "apps/canvas/js/mPaasIntalled.js"
      ],
      "matches": [
        "*://*/accounts/*/external_tools/*",
        "*://*/courses/*/external_tools/*"
      ]
    },
    {
      "css": [
        "plugins/toast/css/toast.css",
        "css/custom.css",
        "apps/moodle/css/moodle.css"
      ],
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "plugins/toast/js/toast.js",
        "constants/rpaasPluginConstants.js",
        "js/apiService.js",
        "js/sharedTemplate.js",
        "services/commonService.js",
        "apps/moodle/js/moodleTemplate.js",
        "apps/moodle/js/teacherView.js"
      ],
      "matches": ["*://*/course/modedit.php*", "*://*/*/course/modedit.php*"]
    },
    {
      "css": [
        "plugins/toast/css/toast.css",
        "css/custom.css",
        "apps/moodle/css/moodle.css"
      ],
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "plugins/bootstrap/js/jqpage.js",
        "plugins/toast/js/toast.js",
        "js/sharedTemplate.js",
        "constants/rpaasPluginConstants.js",
        "js/apiService.js",
        "services/loginService.js",
        "services/commonService.js",
        "apps/moodle/js/mpaasTool.js"
      ],
      "matches": [
        "*://*/mod/lti/view.php?id=*",
        "*://*/*/mod/lti/view.php?id=*"
      ]
    },
    {
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "js/MP.js",
        "constants/rpaasPluginConstants.js",
        "apps/moodle/js/checkTool.js"
      ],
      "matches": [
        "*://*/course/view.php?id=*",
        "*://*/mod/quiz/review.php*",
        "*://*/mod/quiz/edit.php?cmid=*",
        "*://*/mod/quiz/summary.php*",
        "*://*/*/course/view.php?id=*",
        "*://*/*/mod/quiz/review.php*",
        "*://*/*/mod/quiz/edit.php?cmid=*",
        "*://*/*/mod/quiz/summary.php*"
      ]
    },
    {
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "constants/rpaasPluginConstants.js",
        "js/checkNavigatedPage.js",
        "js/navigationOff.js"
      ],
      // V3: '<all_urls>' cannot be used directly in 'matches' within content_scripts.
      // You must use 'all_frames' and/or include specific match patterns, or apply 'scripting' permissions
      // and inject programmatically. Given the original 'exclude_matches', this suggests it's for broad pages.
      // For broad page injections while excluding specific ones, you often need to define specific
      // match patterns or request 'host_permissions' for all possible hosts and then use conditional
      // logic inside your content script to check window.location.href, or use `scripting` API.
      // For simplicity here, I'm keeping 'all_urls' in host_permissions and adding a very broad match pattern
      // to this content script entry, but this might need refinement based on exact exclusion logic.
      // If the intent is truly ALL urls EXCEPT the excluded, a programmatic injection from the
      // service worker using chrome.scripting.executeScript after URL checks might be better.
      "matches": ["<all_urls>"], // This will require "host_permissions": ["<all_urls>"]
      // "exclude_matches" is still valid in V3.
      "exclude_matches": [
        "*://*/mod/quiz/summary.php*",
        "*://*/mod/quiz/review.php*",
        "*://*/courses/*/quizzes/*",
        "*://*/*/mod/quiz/summary.php*",
        "*://*/*/mod/quiz/review.php*",
        "*://*/*/mod/quiz/attempt*",
        "*://*/proctoring",
        "*://*/mod/quiz/attempt*",
        "*://*:*/courses/*/quizzes/*/take",
        "*://*/courses/*/quizzes/*/take/questions/*",
        "https://*/d2l/lms/quizzing/user/quiz_submissions.d2l*",
        "https://*/d2l/lms/quizzing/user/attempt/quiz_start_frame_auto.*",
        "https://*/webapps/assessment/take/take.jsp?course_assessment_id=*",
        "https://*/webapps/assessment/take/submitted.jsp?course_assessment_id=*&course_id=*&content_id=*&step=null",
        "https://*/webapps/assessment/take/launch.jsp?course_assessment_id=*&course_id=*&content_id=*&isPasswordAttempted=true&password=*&step=*"
      ]
    },
    {
      "css": [
        "plugins/toast/css/toast.css",
        "css/custom.css",
        "apps/moodle/css/moodle.css"
      ],
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "plugins/toast/js/toast.js",
        "js/MP.js",
        "constants/rpaasPluginConstants.js",
        "js/apiService.js",
        "js/sharedTemplate.js",
        "services/loginService.js",
        "services/commonService.js",
        "apps/moodle/js/moodleTemplate.js",
        "apps/moodle/js/studentView.js"
      ],
      "matches": [
        "*://*/mod/quiz/view.php?id=*",
        "*://*/mod/quiz/view.php?id=*&forceview=*",
        "*://*/*/mod/quiz/view.php?id=*",
        "*://*/*/mod/quiz/view.php?id=*&forceview=*"
      ]
    },
    {
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "constants/rpaasPluginConstants.js",
        "js/dWindowCheck.js"
      ],
      "matches": ["*://*/proctoring"]
    },
    {
      "css": [
        "plugins/toast/css/toast.css",
        "css/custom.css",
        "apps/moodle/css/moodle.css"
      ],
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "plugins/toast/js/toast.js",
        "js/MP.js",
        "js/sharedTemplate.js",
        "constants/rpaasPluginConstants.js",
        "services/commonService.js",
        "apps/moodle/js/moodleTemplate.js",
        "js/apiService.js",
        "apps/moodle/js/takeQuiz.js"
      ],
      "matches": [
        "*://*/mod/quiz/attempt.php*",
        "*://*/mod/quiz/summary.php*",
        "*://*/*/mod/quiz/attempt.php*",
        "*://*/*/mod/quiz/summary.php*"
      ]
    },
    {
      "css": [
        "plugins/bootstrap/css/bootstrap.min.css",
        "plugins/toast/css/toast.css",
        "css/custom.css",
        "apps/blackboard/css/blackboard.css"
      ],
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "plugins/bootstrap/js/bootstrap.min.js",
        "plugins/bootstrap/js/popper.min.js",
        "plugins/toast/js/toast.js",
        "js/sharedTemplate.js",
        "constants/rpaasPluginConstants.js",
        "js/apiService.js",
        "services/commonService.js",
        "apps/blackboard/js/blackboardTemplate.js",
        "apps/blackboard/js/teacherView.js"
      ],
      "matches": [
        "https://*/webapps/assessment/do/content/addAssessment",
        "https://*/webapps/assessment/do/content/assessment?action=MODIFY*"
      ]
    },
    {
      "css": [
        "plugins/bootstrap/css/bootstrap.min.css",
        "plugins/toast/css/toast.css",
        "css/custom.css",
        "apps/blackboard/css/blackboard.css"
      ],
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "plugins/toast/js/toast.js",
        "js/sharedTemplate.js",
        "constants/rpaasPluginConstants.js",
        "js/apiService.js",
        "services/loginService.js",
        "services/commonService.js",
        "apps/blackboard/js/mpaasTool.js"
      ],
      "matches": ["https://*/webapps/blackboard/content/contentWrapper.jsp*"],
      "run_at": "document_end"
    },
    {
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "constants/rpaasPluginConstants.js",
        "js/MP.js",
        "services/commonService.js",
        "apps/blackboard/js/checkTool.js"
      ],
      "matches": [
        "https://*/webapps/blackboard/content/listContentEditable.jsp*",
        "https://*/webapps/blackboard/content/listContent.jsp*",
        "https://*/webapps/assessment/take/submitted.jsp?course_assessment_id=*&course_id=*&content_id=*&step=null"
      ]
    },
    {
      "css": [
        "plugins/bootstrap/css/bootstrap.min.css",
        "plugins/toast/css/toast.css",
        "css/custom.css",
        "apps/blackboard/css/blackboard.css"
      ],
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "plugins/toast/js/toast.js",
        "js/MP.js",
        "constants/rpaasPluginConstants.js",
        "js/apiService.js",
        "js/sharedTemplate.js",
        "services/loginService.js",
        "services/commonService.js",
        "apps/blackboard/js/blackboardTemplate.js",
        "apps/blackboard/js/studentView.js"
      ],
      "matches": [
        "https://*/webapps/assessment/take/launch.jsp?course_assessment_id=*&course_id=*&new_attempt=*&content_id=*&step=*",
        "https://*/webapps/assessment/take/launch.jsp?course_assessment_id=*&course_id=*&content_id=*&step=null"
      ]
    },
    {
      "css": [
        "plugins/toast/css/toast.css",
        "css/custom.css",
        "apps/blackboard/css/blackboard.css"
      ],
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "plugins/toast/js/toast.js",
        "js/MP.js",
        "js/sharedTemplate.js",
        "constants/rpaasPluginConstants.js",
        "services/commonService.js",
        "apps/blackboard/js/blackboardTemplate.js",
        "apps/blackboard/js/takeQuiz.js"
      ],
      "matches": [
        "https://*/webapps/assessment/take/take.jsp?course_assessment_id=*",
        "https://*/webapps/assessment/take/launch.jsp?course_assessment_id=*&course_id=*&content_id=*&isPasswordAttempted=true&password=*&step=*"
      ]
    },
    {
      "css": [
        "plugins/bootstrap/css/bootstrap.min.css",
        "plugins/toast/css/toast.css",
        "css/custom.css",
        "apps/d2l/css/d2l.css"
      ],
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "plugins/bootstrap/js/bootstrap.min.js",
        "plugins/bootstrap/js/popper.min.js",
        "plugins/toast/js/toast.js",
        "js/sharedTemplate.js",
        "constants/rpaasPluginConstants.js",
        "js/apiService.js",
        "services/loginService.js",
        "services/commonService.js",
        "apps/d2l/js/mpaasTool.js"
      ],
      "matches": [
        "https://*/d2l/le/lessons/*",
        "https://*/d2l/le/lessons/*/topics/*",
        "https://*/d2l/le/lessons/*/units/*",
        "https://*/d2l/le/content/*/viewContent/*/View"
      ],
      "run_at": "document_end"
    },
    {
      "css": [
        "plugins/toast/css/toast.css",
        "css/custom.css",
        "apps/d2l/css/d2l.css"
      ],
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "plugins/bootstrap/js/bootstrap.min.js",
        "plugins/bootstrap/js/popper.min.js",
        "plugins/toast/js/toast.js",
        "js/sharedTemplate.js",
        "js/apiService.js",
        "constants/rpaasPluginConstants.js",
        "services/commonService.js",
        "apps/d2l/js/d2lTemplate.js",
        "apps/d2l/js/teacherView.js"
      ],
      "matches": ["https://*/d2l/lms/quizzing/*/modify/*"]
    },
    {
      "css": [
        "plugins/bootstrap/css/bootstrap.min.css",
        "plugins/toast/css/toast.css",
        "css/custom.css",
        "apps/d2l/css/d2l.css"
      ],
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "plugins/toast/js/toast.js",
        "js/MP.js",
        "constants/rpaasPluginConstants.js",
        "js/apiService.js",
        "js/sharedTemplate.js",
        "services/loginService.js",
        "services/commonService.js",
        "apps/d2l/js/d2lTemplate.js",
        "apps/d2l/js/studentView.js"
      ],
      "matches": [
        "https://*/d2l/le/content/*/viewContent/*",
        "https://*/d2l/lms/quizzing/user/quiz_summary*"
      ]
    },
    {
      "css": [
        "plugins/toast/css/toast.css",
        "css/custom.css",
        "apps/d2l/css/d2l.css"
      ],
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "plugins/toast/js/toast.js",
        "js/MP.js",
        "js/sharedTemplate.js",
        "constants/rpaasPluginConstants.js",
        "services/commonService.js",
        "apps/d2l/js/d2lTemplate.js",
        "apps/d2l/js/takeQuiz.js"
      ],
      "matches": [
        "https://*/d2l/lms/quizzing/user/attempt/quiz_start_frame_auto.*"
      ]
    },
    {
      "js": [
        "plugins/bootstrap/js/jquery.min.js",
        "constants/rpaasPluginConstants.js",
        "js/MP.js",
        "services/commonService.js",
        "js/apiService.js",
        "apps/d2l/js/checkTool.js"
      ],
      "matches": [
        "https://*/d2l/lms/quizzing/user/quiz_submissions.d2l*",
        "*://*/courses/*/quizzes/*"
      ]
    }
  ],
  // V3: 'content_security_policy' is much stricter by default.
  // 'unsafe-eval' is no longer allowed for script-src unless it's only for sandboxed pages.
  // You might need to refactor code that uses eval() or new Function().
  // It's generally recommended to remove this line unless you specifically need to relax default CSP
  // and understand the security implications. For standard extensions, the default CSP is usually sufficient.
  // I've removed it for strict V3 compliance, assuming no 'eval' is used for content scripts.
  // If 'unsafe-eval' is critical for a specific script (e.g., jQuery plugins using it), you must use
  // a sandboxed iframe or refactor that code.
  // "content_security_policy": "script-src 'self' 'unsafe-eval'; object-src 'self'", // REMOVED/REFACTORED

  // V3: Permissions are stricter.
  // Host permissions need to be explicitly listed.
  // '<all_urls>' is moved to 'host_permissions'.
  "permissions": ["storage", "tabs", "contentSettings", "management"],
  "host_permissions": [
    "https://*.wheebox.com/",
    // Adding <all_urls> to cover the broad matching in content_scripts.
    // This is a powerful permission and should be used cautiously.
    // Consider narrowing down specific host patterns if possible.
    "<all_urls>"
  ],
  // V3: 'web_accessible_resources' is now an array of objects with 'resources' and 'matches' keys.
  // 'matches' specifies which origins can access the resources.
  "web_accessible_resources": [
    {
      "resources": [
        "assets/*.png",
        "assets/*.mp3",
        "assets/*.svg",
        "assets/*.gif"
      ],
      // Allow all origins that the content scripts match to access these resources.
      // This is a broad match, you might want to narrow it down if possible.
      "matches": ["<all_urls>"]
    }
  ]
}
